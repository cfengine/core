######################################################
#
#  Test that ${this.promiser} is expanded in comments (Issue 691)
#
#####################################################

body common control
{
      inputs => { "../../default.cf.sub" };
      bundlesequence  => { default("$(this.promise_filename)") };
      version => "1.0";
}

#######################################################

bundle agent test
{
  meta:
      "test_skip_needs_work" string => "windows";

  methods:
      "" usebundle => dcs_passif_output(".*foobar.*", # wanted
                                        ".*this\.promiser.*", # unwanted
                                        "$(sys.cf_agent) -Kvf $(this.promise_filename).sub | grep Comment",
                                        $(this.promise_filename)),
      inherit => "true";
}
