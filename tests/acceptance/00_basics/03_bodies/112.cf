#######################################################
#
# Test repair_failed and cancel_notkept
# Insert lines to a file, verify that insert promise is repaired
#
# Present in both 00_basics/03_bodies and 10_files/05_classes
#
#######################################################

body common control
{
      inputs => { "../../default.cf.sub" };
      bundlesequence  => { default("$(this.promise_filename)") };
      version => "1.0";
}

bundle agent init
{
  methods:
      "" usebundle => dcs_all_negative_classes("t");
}

#######################################################

bundle agent test
{
  files:
      "$(G.testfile)"
      # create => "true", # file will not exist!
      edit_line => insert_lines($(dcs_strings.multiline_potatoes)),
      edit_defaults => empty,
      classes => dcs_all_classes("t");
}

#######################################################

bundle agent check
{
  methods:
      "" usebundle => dcs_all_classes_to_string("t"),
      useresult => "actual";

      "" usebundle => dcs_check_strcmp('{ "t_cancel_kept", "t_cancel_repaired", "t_repair_failed" }',
                                       "$(actual[str])",
                                       $(this.promise_filename),
                                       "no");
}
