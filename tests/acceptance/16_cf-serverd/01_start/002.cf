#
body common control
{
      inputs => { "../../default.cf.sub", "./run_with_server.cf.sub" };
      bundlesequence => { test };
      version => "1.0";
}

bundle agent test
{
  meta:
      "test_suppress_fail" string => "windows",
        meta => { "redmine4822" };

  classes:
      "debug_server" expression => "any", scope => "namespace";
      "debug_client" expression => "any", scope => "namespace";

  methods:
      "any" usebundle => default_cf_sub_makefile("$(G.testdir)/destination_file",
                                                 "This is the source file to copy $(sys.date) - always fresh... more data!");

      # We generate key in-between the two files on purpose, to
      # introduce latency and make sure the two timestamps are different
      "any" usebundle => generate_key;

      "any" usebundle => default_cf_sub_makefile("$(G.testdir)/source_file",
                                                 "This is the source file to copy $(sys.date) - always fresh");
      "any" usebundle => start_server("localhost_open");
      "any" usebundle => run_test("$(this.promise_filename).sub");
      "any" usebundle => stop_server("localhost_open");
}
