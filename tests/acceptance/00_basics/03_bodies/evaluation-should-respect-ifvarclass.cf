##############################################################################
#
# Redmine #3577: evaluation should respect ifvarclass
#
##############################################################################

body common control
{
      inputs => { "../../default.cf.sub" };
      bundlesequence => { default("$(this.promise_filename)") };
      version => "1.0";
}

bundle agent test
{
  vars:
      "x" string => concat("a", "b"),
      ifvarclass => "!any";
    !any::
      "y" string => concat("c", "d");
}

bundle agent check
{
  classes:
      "eval_x" expression => strcmp("ab", "$(test.x)");
      "eval_y" expression => strcmp("cd", "$(test.y)");

  methods:
      "" usebundle => dcs_passif_expected("", # expected
                                          "eval_x,eval_y", # not expected
                                          $(this.promise_filename)),
      inherit => "true";

  reports:
    EXTRA::
      "x $(test.x)";
      "y $(test.y)";
    DEBUG.eval_x::
      "bad: x evaluated";
    DEBUG.eval_y::
      "bad: y evaluated";
    EXTRA.eval_x::
      "good: x not evaluated";
    EXTRA.eval_y::
      "good: y not evaluated";
}
