#######################################################
#
# Test execresult() with regular shell
#
#######################################################

body common control
{
  inputs => { "../../default.cf.sub" };
  bundlesequence  => { default("$(this.promise_filename)") };   
  version => "1.0";
}

bundle common g
{
vars:
	"dummy" string => "dummy";
}

#######################################################

bundle agent init
{
vars:
}

#######################################################

bundle agent test
{
vars:
}


#######################################################

bundle agent check
{
vars:
       "list"    slist => { "one", "two", "three"  };

       "other"    slist => { @(list)  };

  !windows::
    "cwd" string => execresult("/bin/cat $(G.cwd)/text.txt", "useshell");
  windows::
    "cwd" string => execresult("C:\windows\system32\cmd.exe /C type $(G.cwd)\text.txt", "useshell");

classes:

  "ok" expression => strcmp("Succeeded", "$(cwd)");

reports:
    ok::
	"$(this.promise_filename) Pass";

    !ok::
	"$(this.promise_filename) FAIL";
}

#######################################################

bundle agent fini
{
vars:
	"dummy" string => "dummy";
}
